///////////////////////////////////////////////////////////////////////////
// @brief     PacketFactory
///////////////////////////////////////////////////////////////////////////


#include "pch.h"
#include "PacketFactory.h"
#include "../Packet/PacketFactory/PacketCreateList.h"


///////////////////////////////////////////////////////////////////////////
// @brief     생성자
///////////////////////////////////////////////////////////////////////////
PacketFactory::PacketFactory()
	: m_packetBaseSize( sizeof( PacketBase ) )
{
}

///////////////////////////////////////////////////////////////////////////
// @brief     수신 데이터의 크기가 PacketBase가 되는지 체크한다.
///////////////////////////////////////////////////////////////////////////
bool PacketFactory::IsPacketBaseSize( int receiveSize )
{
	return m_packetBaseSize <= receiveSize;
}

///////////////////////////////////////////////////////////////////////////
// @brief     data에서 패킷사이즈 만큼을 추출한다.
///////////////////////////////////////////////////////////////////////////
char* PacketFactory::_SubData( char* data, int size )
{
	/// TODO 데이터 추출하는 부분 폴리싱
	/// 데이터 떙기고 뒤에 자르는거 필요함
	memmove( data, data + size, size );

	return nullptr;
}

///////////////////////////////////////////////////////////////////////////
// @brief     패킷을 생성하여 반환한다.
///////////////////////////////////////////////////////////////////////////
PacketBase* PacketFactory::MakePacket( char* data, int receiveSize )
{
	data = _SubData( data, m_packetBaseSize );

	ReaderStream readerStream( data );

	PacketBase* packet = new PacketBase; // TODO : 스마트 포인터로 바꾸기
	packet->Deserialize( readerStream );

	return CreatePacket( (EPacketId)( packet->GetPktId() ) );
}